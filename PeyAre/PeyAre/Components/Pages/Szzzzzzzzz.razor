@page "/Nation"
@using PeyAre.Service
@using PeyAre.Models
@inject PredictNationService PredictNationService

<MudGrid>
    @if (nameDataList != null)
    {
        @foreach (var nameData in nameDataList)
        {
            <MudItem xs="12" sm="6" md="4">
                <MudCard>
                    <MudCardContent>
                        <MudText Typo="Typo.h6">@nameData.Name</MudText>
                        <MudText>@nameData.Count</MudText>
                        <MudText><strong>Highest Probability Country:</strong> @GetHighestProbabilityCountry(nameData.Country)?.CountryId ?? "N/A"</MudText>
                        <MudText><strong>Probability:</strong> @GetHighestProbabilityCountry(nameData.Country)?.Probability.ToString("F2") ?? "N/A"</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        }
    }
</MudGrid>

@code {
    private List<NameData> nameDataList;
    private string apiKey = "b01e7377fb979ab85788c5c7b782d561"; // Replace with your API key

    protected override async Task OnInitializedAsync()
    {
        await FetchNation();
    }

    private async Task FetchNation()
    {
        nameDataList = await PredictNationService.GetPredictionResponseAsync(apiKey) ?? new List<NameData>();
    }

    private CountryProbability GetHighestProbabilityCountry(List<CountryProbability> countries)
    {
        return countries?.OrderByDescending(c => c.Probability).FirstOrDefault();
    }
}
